<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Заявки до клану</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{background: linear-gradient(135deg,#0a0f1e,#121a33); color:#e9efff; font-family:sans-serif;}
.bg-glass{background: rgba(255,255,255,0.08); backdrop-filter: blur(14px);}
.pill{border-radius:999px;}
.shine{position:relative; overflow:hidden;}
.shine::after{content:'';position:absolute;inset:-250% -50%;background:linear-gradient(120deg,transparent 45%,rgba(255,255,255,.12) 50%,transparent 55%);transform:rotate(12deg);animation:shine 8s linear infinite;}
@keyframes shine{0%{transform:translateX(-60%) rotate(12deg);}100%{transform:translateX(60%) rotate(12deg);}}
</style>
</head>
<body class="min-h-screen p-4">
<header class="mb-4">
<h1 class="text-2xl font-bold">⚔️ Заявки на вступ у клан</h1>
<p class="text-slate-300 text-sm">Всі заявки зберігаються на GitHub. Редагування лише за паролем.</p>
<button id="newAppBtn" class="pill bg-blue-500/80 px-4 py-2 mt-2">Подати заявку</button>
</header>
<main>
<section class="grid md:grid-cols-2 gap-4" id="list"></section>
<div id="empty" class="text-slate-400 text-center py-10">Поки що заявок немає.</div>
<div class="mt-6 text-center">
<button id="editBtn" class="pill bg-emerald-500/80 px-4 py-2">Редагувати заявки</button>
</div>
</main>
<script>
// ========== CONFIG ==========
const GH_OWNER = 'YOUR_OWNER'; // твій GitHub username
const GH_REPO = 'YOUR_REPO';   // твій репо
const ISSUE_LABEL = 'application';
const SECRET_PASS = 'SlotHim08831'; // пароль

let canEdit = false;

document.getElementById('editBtn').addEventListener('click', ()=>{
  const p = prompt('Введіть секретний пароль:');
  if(p===SECRET_PASS){
    canEdit=true; 
    alert('Доступ до редагування увімкнено'); 
    renderIssues();
  } else { 
    alert('Невірний пароль'); 
  }
});

document.getElementById('newAppBtn').addEventListener('click', ()=>{
  window.open(`https://github.com/${GH_OWNER}/${GH_REPO}/issues/new?labels=${encodeURIComponent(ISSUE_LABEL)}&template=join-clan.yml`,'_blank');
});

const listEl = document.getElementById('list');
const emptyEl = document.getElementById('empty');

async function fetchIssues(){
  const url = `https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/issues?state=all&labels=${encodeURIComponent(ISSUE_LABEL)}&per_page=100`;
  const res = await fetch(url);
  if(!res.ok){listEl.innerHTML='Помилка при отриманні заявок'; return;}
  const data = await res.json();
  const issues = data.filter(x=>!x.pull_request);
  renderIssues(issues);
}

function mdToHtml(md){
  return md.replace(/\n/g,'<br>');
}

function statusFromLabels(labels){
  const names = labels.map(l=>l.name);
  if(names.includes('approved')) return 'approved';
  if(names.includes('rejected')) return 'rejected';
  return 'pending';
}

function renderIssues(issues){
  if(!issues) return;
  listEl.innerHTML='';
  if(issues.length===0){ emptyEl.style.display='block'; return; } else { emptyEl.style.display='none'; }

  issues.forEach(iss=>{
    const st = statusFromLabels(iss.labels);
    const card = document.createElement('div');
    card.className='bg-glass p-4 rounded-2xl shadow shine';
    card.innerHTML = `
      <div class='flex justify-between'><h3 class='font-bold'>${iss.title||'Без назви'}</h3><span>${st==='approved'?'Прийнято':st==='rejected'?'Відхилено':'На розгляді'}</span></div>
      <div class='text-xs text-slate-300 mt-1'>Створено: ${new Date(iss.created_at).toLocaleString()}</div>
      <details class='mt-2'><summary class='text-slate-200'>Показати деталі анкети</summary><div class='text-sm mt-2'>${mdToHtml(iss.body||'—')}</div></details>
      <div class='mt-3 flex gap-2'>
        <a href='${iss.html_url}' target='_blank' class='pill bg-glass px-3 py-2 border border-white/10 text-sm'>Відкрити в GitHub</a>
        <a href='${iss.html_url}' target='_blank' class='pill px-3 py-2 text-sm bg-emerald-500/80 hover:bg-emerald-500 ${canEdit?'':'hidden'}'>Прийняти</a>
        <a href='${iss.html_url}' target='_blank' class='pill px-3 py-2 text-sm bg-rose-500/80 hover:bg-rose-500 ${canEdit?'':'hidden'}'>Відхилити</a>
      </div>
    `;
    listEl.appendChild(card);
  });
}

fetchIssues();
setInterval(fetchIssues,60000);
</script>
</body>
</html>
