<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Заявки до клану</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{background: linear-gradient(135deg,#0a0f1e,#121a33); color:#e9efff; font-family:sans-serif;}
.pill{border-radius:999px;}
.card{padding:1rem; border-radius:1rem; background:rgba(255,255,255,0.05); margin-bottom:1rem;}
</style>
</head>
<body class="min-h-screen p-4">
<header class="mb-4">
<h1 class="text-2xl font-bold">⚔️ Заявки на вступ у клан</h1>
<p class="text-slate-300 text-sm">Всі заявки зберігаються на GitHub і доступні з будь-якого пристрою. Редагування за паролем.</p>
<div class="mt-2 flex gap-2">
<button id="newAppBtn" class="pill bg-blue-500/80 px-4 py-2">Подати анкету</button>
<button id="editBtn" class="pill bg-emerald-500/80 px-4 py-2">Редагувати анкети</button>
</div>
</header>

<main>
<div id="list"></div>
<div id="empty" class="text-center text-slate-400 py-10">Поки що заявок немає.</div>
</main>

<script>
const GH_OWNER='YOUR_GITHUB_USERNAME'; // твій GitHub
const GH_REPO='YOUR_REPO'; // репо
const ISSUE_LABEL='application';
const SECRET_PASS='SlotHim08831';
let canEdit=false;

// Відкрити форму GitHub Issue Form
document.getElementById('newAppBtn').addEventListener('click', ()=>{
  window.open(`https://github.com/${GH_OWNER}/${GH_REPO}/issues/new?template=join-clan.yml`,'_blank');
});

// Редагування
document.getElementById('editBtn').addEventListener('click', ()=>{
  const p = prompt("Введіть секретний пароль:");
  if(p===SECRET_PASS){ canEdit=true; alert("Доступ увімкнено"); fetchIssues(); }
  else alert("Невірний пароль");
});

// Підтягування заявок з GitHub
async function fetchIssues(){
  const res = await fetch(`https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/issues?state=open&labels=${ISSUE_LABEL}&per_page=100`);
  if(!res.ok){ document.getElementById('list').innerHTML='Помилка отримання заявок'; return; }
  const issues = await res.json();
  renderIssues(issues);
}

function renderIssues(issues){
  const listEl = document.getElementById('list');
  listEl.innerHTML='';
  if(!issues || issues.length===0){ document.getElementById('empty').style.display='block'; return; }
  else document.getElementById('empty').style.display='none';

  issues.forEach(iss=>{
    const st = iss.labels.some(l=>l.name==='approved')?'Схвалено':iss.labels.some(l=>l.name==='rejected')?'Відхилено':'На розгляді';
    const card = document.createElement('div');
    card.className='card';
    card.innerHTML = `
      <strong>${iss.title}</strong> — ${st}<br>
      <details>
        <summary>Показати анкету</summary>
        <pre>${iss.body}</pre>
      </details>
      ${canEdit?`<div class="mt-2 flex gap-2">
        <button onclick="approve('${iss.number}')" class="bg-green-500/80 px-3 py-1 pill">Схвалити</button>
        <button onclick="reject('${iss.number}')" class="bg-red-500/80 px-3 py-1 pill">Відхилити</button>
        <button onclick="comment('${iss.number}')" class="bg-blue-500/80 px-3 py-1 pill">Коментар</button>
      </div>`:''}
    `;
    listEl.appendChild(card);
  });
}

// Для реального редагування через GitHub API потрібен Token
function approve(num){ alert(`Для схвалення анкети #${num} потрібен GitHub Token`); }
function reject(num){ alert(`Для відхилення анкети #${num} потрібен GitHub Token`); }
function comment(num){ alert(`Для коментаря анкети #${num} потрібен GitHub Token`); }

fetchIssues();
setInterval(fetchIssues,60000);
</script>
</body>
</html>
