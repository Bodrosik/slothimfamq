<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‚öîÔ∏è –§–æ—Ä–º–∞ –¥–ª—è –≤—Å—Ç—É–ø—É –≤ –∫–ª–∞–Ω</title>
  <style>
    :root {
      --bg: #0b0f1a;
      --card: #111827;
      --muted: #9aa4b2;
      --line: #223054;
      --accent: #2a6efb;
      --ok: #16a34a;
      --bad: #dc2626;
      --text: #e6e9ef;
      --pill: #314168;
      --radius: 12px;
      --gap: 14px;
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif; background: var(--bg); color: var(--text); }
    header { position: sticky; top:0; z-index:5; padding:20px 16px; background: linear-gradient(135deg,#10182a,#0c1222 60%,#0b0f1a); border-bottom:1px solid #1b2745; }
    h1 { margin:0 0 6px; font-size:22px; }
    .sub { color: var(--muted); font-size:14px; }
    main { max-width: 1080px; margin: 18px auto 40px; padding: 0 14px; display:grid; gap:18px; }
    .card { background: var(--card); border:1px solid var(--line); border-radius: var(--radius); padding: 16px; box-shadow: 0 12px 28px rgba(0,0,0,.28); }
    .grid { display:grid; gap: var(--gap); }
    .g2 { grid-template-columns: 1fr 1fr; }
    @media (max-width: 820px){ .g2 { grid-template-columns: 1fr; } }
    label { font-size:14px; color:#d7deea; display:block; margin-bottom:6px; }
    input, textarea, select {
      width:100%; border-radius:10px; border:1px solid #273352; background:#0f1726; color:var(--text);
      padding:10px 12px; outline:none;
    }
    textarea { min-height: 90px; resize: vertical; }

    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .right { justify-content:flex-end; }
    .btn {
      border:1px solid #2a3a64; background:#1a2540; color:var(--text);
      padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600; transition:.15s transform ease, .15s background ease;
      user-select:none;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn:disabled { opacity:.6; cursor:not-allowed; transform:none; }
    .primary { background: var(--accent); border-color: var(--accent); color:#fff; }
    .success { background: var(--ok); border-color:#148b40; }
    .danger  { background: var(--bad); border-color:#b51f1f; }
    .ghost   { background: transparent; }

    .muted { color: var(--muted); }
    .tag { display:inline-block; border:1px solid var(--pill); background:#141d31; padding:2px 8px; border-radius:999px; font-size:12px; }

    .item { border:1px solid var(--line); background:#0f1730; border-radius:12px; padding:12px; display:grid; gap:10px; }
    .item-head { display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; }
    .item-meta { display:flex; gap:8px; align-items:center; flex-wrap:wrap; font-size:13px; color:#cbd5e1; }
    .sep { height:1px; background:#1b2745; margin:6px 0; }

    .status { padding:3px 9px; border-radius:999px; font-size:12px; border:1px solid; }
    .pending { border-color:#6b7280; color:#e5e7eb; }
    .approved { border-color:#1c8a55; color:#86efac; }
    .rejected { border-color:#b6313a; color:#fecaca; }

    details summary { cursor:pointer; list-style:none; }
    details summary::-webkit-details-marker { display:none; }
    summary .twist { display:inline-block; width:1em; text-align:center; transition: transform .2s; }
    details[open] summary .twist { transform: rotate(90deg); }

    code.inline {
      background:#0d1426; padding:2px 6px; border-radius:6px;
      border:1px solid #1d2950; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    }

    .comment-box { display:flex; gap:8px; flex-wrap:wrap; }
    .comment-box input { flex:1 1 240px; }
  </style>
</head>
<body>
  <header>
    <h1>‚öîÔ∏è –§–æ—Ä–º–∞ –¥–ª—è –≤—Å—Ç—É–ø—É –≤ –∫–ª–∞–Ω</h1>
    <div class="sub">–ü–æ–¥–∞–≤–∞–π –∞–Ω–∫–µ—Ç—É. –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä (–ø–∞—Ä–æ–ª—å: <code class="inline">SlotHim0089</code>) –º–æ–∂–µ —Å—Ö–≤–∞–ª–∏—Ç–∏/–≤—ñ–¥—Ö–∏–ª–∏—Ç–∏ –π –ª–∏—à–∏—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä.</div>
  </header>

  <main class="grid">
    <!-- SUBMIT FORM -->
    <section class="card">
      <h2 style="margin:0 0 10px;">–ü–æ–¥–∞—Ç–∏ –∞–Ω–∫–µ—Ç—É</h2>
      <form id="form" class="grid g2">
        <div>
          <label>üë§ 1. –ù—ñ–∫ —É –≥—Ä—ñ</label>
          <input name="nick" required maxlength="40" placeholder="–ù–∞–ø—Ä., Slothim">
        </div>
        <div>
          <label>üÜî 2. ID</label>
          <input name="gameId" required maxlength="40" placeholder="–í–∞—à —ñ–≥—Ä–æ–≤–∏–π ID">
        </div>
        <div>
          <label>üéÇ 3. –í—ñ–∫</label>
          <input name="age" type="number" min="5" max="120" required placeholder="12">
        </div>
        <div>
          <label>üåç 4. –ß–∞—Å–æ–≤–∏–π –ø–æ—è—Å / –º—ñ—Å—Ç–æ</label>
          <input name="tzCity" required placeholder="UTC+3 / –ö–∏—ó–≤">
        </div>
        <div>
          <label>‚è∞ 5. –°–∫—ñ–ª—å–∫–∏ —á–∞—Å—É –ø—Ä–æ–≤–æ–¥–∏—à —É –≥—Ä—ñ —â–æ–¥–Ω—è</label>
          <input name="daily" required placeholder="–ù–∞–ø—Ä., 2‚Äì4 –≥–æ–¥–∏–Ω–∏">
        </div>
        <div>
          <label>üìÖ 6. –°–∫—ñ–ª—å–∫–∏ —á–∞—Å—É –≥—Ä–∞—î—à –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ</label>
          <input name="serverTime" required placeholder="–ù–∞–ø—Ä., 1 —Ç–∏–∂–¥–µ–Ω—å / 3 –º—ñ—Å—è—Ü—ñ">
        </div>
        <div>
          <label>üè∞ 7. –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ –∫–ª–∞–Ω–∏ (—è–∫—â–æ –±—É–ª–∏)</label>
          <input name="prevClans" placeholder="‚Äî">
        </div>
        <div>
          <label>üö™ 8. –ü—Ä–∏—á–∏–Ω–∞ –≤–∏—Ö–æ–¥—É –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∫–ª–∞–Ω—É</label>
          <input name="leaveReason" placeholder="‚Äî">
        </div>
        <div style="grid-column:1 / -1;">
          <label>‚ú® 9. –ß–æ–º—É —Ö–æ—á–µ—à –≤—Å—Ç—É–ø–∏—Ç–∏ —Å–∞–º–µ –¥–æ –Ω–∞—à–æ–≥–æ –∫–ª–∞–Ω—É</label>
          <textarea name="whyUs" required></textarea>
        </div>
        <div style="grid-column:1 / -1;">
          <label>üí™ 10. –ß–∏–º –≥–æ—Ç–æ–≤–∏–π –¥–æ–ø–æ–º–∞–≥–∞—Ç–∏ –∫–ª–∞–Ω—É (–∞–∫—Ç–∏–≤, —Ä–µ—Å—É—Ä—Å–∏, —ñ–≤–µ–Ω—Ç–∏, –µ–∫–æ–Ω–æ–º—ñ–∫–∞)</label>
          <textarea name="help" required></textarea>
        </div>
        <div>
          <label>üìè 11. –°—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–æ –¥–∏—Å—Ü–∏–ø–ª—ñ–Ω–∏ —Ç–∞ –ø—Ä–∞–≤–∏–ª</label>
          <input name="discipline" required placeholder="–ù–∞–ø—Ä., –¥–æ—Ç—Ä–∏–º—É—é—Å—å —Å—É–≤–æ—Ä–æ">
        </div>
        <div>
          <label>üéôÔ∏è 12. –ß–∏ —î –º—ñ–∫—Ä–æ—Ñ–æ–Ω —Ç–∞ Discord</label>
          <input name="micDiscord" required placeholder="–¢–∞–∫/–ù—ñ; –≤–∞—à Discord @–Ω—ñ–∫">
        </div>
        <div>
          <label>üì¢ 13. –ß–∏ –≥–æ—Ç–æ–≤–∏–π –≤–∏—Ö–æ–¥–∏—Ç–∏ –Ω–∞ –∑–±–æ—Ä–∏ –∫–ª–∞–Ω—É</label>
          <input name="meetings" required placeholder="–¢–∞–∫/–ù—ñ/–ó–∞ –¥–æ–º–æ–≤–ª–µ–Ω—ñ—Å—Ç—é">
        </div>
        <div>
          <label>üìñ 14. –ù–∞—Å–∫—ñ–ª—å–∫–∏ –¥–æ–±—Ä–µ –∑–Ω–∞—î—à –ø—Ä–∞–≤–∏–ª–∞ —Å–µ—Ä–≤–µ—Ä—É (1‚Äì10)</label>
          <input name="rules" type="number" min="1" max="10" required placeholder="7">
        </div>
        <div style="grid-column:1 / -1;">
          <label>üéØ 15. –Ø–∫—ñ –Ω–∞–≤–∏—á–∫–∏ –º–∞—î—à —É –≥—Ä—ñ (—Å—Ç—Ä—ñ–ª—å–±–∞, –≤–æ–¥—ñ–Ω–Ω—è, –µ–∫–æ–Ω–æ–º—ñ–∫–∞ —Ç–æ—â–æ)</label>
          <textarea name="skills" required></textarea>
        </div>
        <div>
          <label>üõ°Ô∏è 16. –ß–∏ –≥–æ—Ç–æ–≤–∏–π –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –≤–∫–∞–∑—ñ–≤–∫–∏ —Å—Ç–∞—Ä—à–∏—Ö</label>
          <input name="followOrders" required placeholder="–¢–∞–∫/–ù—ñ/–ó–∞–ª–µ–∂–∏—Ç—å">
        </div>
        <div>
          <label>üöó 17. –ß–∏ —î –∞–≤—Ç–æ/–±—ñ–∑–Ω–µ—Å, —è–∫–∏–º –º–æ–∂–µ—à –¥–æ–ø–æ–º–∞–≥–∞—Ç–∏</label>
          <input name="assets" placeholder="‚Äî">
        </div>
        <div>
          <label>‚ö†Ô∏è 18. –ß–∏ –±—É–≤ –±–∞–Ω/–≤–∞—Ä–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ (—è–∫—â–æ —Ç–∞–∫ ‚Äì –∑–∞ —â–æ)</label>
          <input name="bans" placeholder="‚Äî">
        </div>
        <div>
          <label>ü§ù 19. –ß–∏ –≥–æ—Ç–æ–≤–∏–π –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –≤ –∫–æ–º–∞–Ω–¥—ñ</label>
          <input name="teamwork" required placeholder="–¢–∞–∫/–ù—ñ">
        </div>
        <div style="grid-column:1 / -1;">
          <label>üìù 20. –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–µ–±–µ</label>
          <textarea name="extra"></textarea>
        </div>

        <div class="row">
          <button class="btn primary" type="submit">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
          <span class="muted">–ü—ñ—Å–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∞ –∑‚Äô—è–≤–∏—Ç—å—Å—è –Ω–∏–∂—á–µ —É —Å–ø–∏—Å–∫—É.</span>
        </div>
      </form>
    </section>

    <!-- MOD LOGIN -->
    <section class="card">
      <h2 style="margin:0 0 10px;">–í—Ö—ñ–¥ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞</h2>
      <div class="row">
        <input id="modPass" type="password" placeholder="–ü–∞—Ä–æ–ª—å –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ (SlotHim0089)">
        <button id="modLogin" class="btn">–£–≤—ñ–π—Ç–∏</button>
        <span class="tag" id="modeTag">Mode: local-only</span>
      </div>
      <div class="row" style="margin-top:8px;">
        <button id="exportBtn" class="btn ghost">–ï–∫—Å–ø–æ—Ä—Ç JSON</button>
        <label class="btn ghost" style="cursor:pointer;">
          –Ü–º–ø–æ—Ä—Ç JSON
          <input id="importInput" type="file" accept="application/json" style="display:none;">
        </label>
        <button id="reloadRemote" class="btn ghost">–û–Ω–æ–≤–∏—Ç–∏ –∑ GitHub</button>
        <span class="muted">–ü–æ—Ä–∞–¥–∞: –µ–∫—Å–ø–æ—Ä—Ç–Ω–∏ <code class="inline">applications.json</code> —ñ –∑–∞–∫–∏–Ω—å —É <code class="inline">/data/</code> —Ä–µ–ø–æ ‚Üí –≤—Å—ñ –ø–æ–±–∞—á–∞—Ç—å.</span>
      </div>
    </section>

    <!-- LIST -->
    <section class="card">
      <div class="row" style="justify-content:space-between;">
        <h2 style="margin:0;">–ó–∞—è–≤–∫–∏</h2>
        <div class="row">
          <input id="search" placeholder="–ü–æ—à—É–∫ –∑–∞ –Ω—ñ–∫–æ–º/ID" />
          <button id="clearAll" class="btn ghost">–û—á–∏—Å—Ç–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—ñ</button>
        </div>
      </div>
      <div id="list" class="grid" style="margin-top:12px;"></div>
    </section>
  </main>

  <script>
    // ========= CONFIG =========
    const MOD_PASSWORD = "SlotHim0089";
    const REMOTE_JSON_URL = "./data/applications.json"; // –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ: —è–∫—â–æ –∑–∞–∫–∏–Ω–µ—Ç–µ —Ñ–∞–π–ª —É —Ä–µ–ø–æ

    // ========= STATE =========
    let STATE = {
      isModerator: false,
      applications: [], // –º–∞—Å–∏–≤ –æ–±'—î–∫—Ç—ñ–≤
    };

    // ========= HELPERS =========
    const $ = s => document.querySelector(s);
    const listEl = $("#list");
    const modeTag = $("#modeTag");

    function uid() { return "id_" + Math.random().toString(36).slice(2) + Date.now().toString(36); }
    function nowISO() { return new Date().toISOString(); }
    function saveLocal() { localStorage.setItem("clan_applications", JSON.stringify(STATE.applications)); }
    function loadLocal() {
      try {
        const raw = localStorage.getItem("clan_applications");
        STATE.applications = raw ? JSON.parse(raw) : [];
      } catch { STATE.applications = []; }
    }
    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
    }
    function nl2br(s){ return String(s).replace(/\n/g,"<br>"); }
    function timeago(iso){
      if(!iso) return "";
      const diff = (Date.now() - new Date(iso).getTime()) / 1000;
      if (diff < 60) return "—â–æ–π–Ω–æ";
      if (diff < 3600) return Math.floor(diff/60) + " —Ö–≤ —Ç–æ–º—É";
      if (diff < 86400) return Math.floor(diff/3600) + " –≥–æ–¥ —Ç–æ–º—É";
      return new Date(iso).toLocaleString();
    }

    function toCSV(items){
      const keys = Object.keys(items[0]||{});
      const esc = v => `"${String(v??"").replace(/"/g,'""')}"`;
      return [keys.join(","), ...items.map(o => keys.map(k => esc(o[k])).join(","))].join("\n");
    }

    function download(name, text, type="application/json"){
      const a = document.createElement("a");
      a.href = URL.createObjectURL(new Blob([text], {type}));
      a.download = name;
      a.click();
      URL.revokeObjectURL(a.href);
    }

    // ========= RENDER =========
    function renderList(filter=""){
      listEl.innerHTML = "";
      const q = filter.trim().toLowerCase();
      let apps = [...STATE.applications].sort((a,b)=>(b.createdAt||"").localeCompare(a.createdAt||""));
      if (q) apps = apps.filter(a =>
        (a.nick||"").toLowerCase().includes(q) ||
        (a.gameId||"").toLowerCase().includes(q)
      );

      if (!apps.length){
        listEl.innerHTML = `<div class="muted">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞ –∑–∞—è–≤–æ–∫.</div>`;
        return;
      }

      for (const app of apps){
        const status = app.status || "pending";
        const statusClass = status==="approved" ? "approved" : status==="rejected" ? "rejected" : "pending";

        const wrap = document.createElement("div");
        wrap.className = "item";

        const head = document.createElement("div");
        head.className = "item-head";
        head.innerHTML = `
          <div class="item-meta">
            <strong>${escapeHtml(app.nick||"(–±–µ–∑ –Ω—ñ–∫—É)")}</strong>
            <span>üÜî ${escapeHtml(app.gameId||"-")}</span>
            <span>üéÇ ${escapeHtml(String(app.age||"-"))}</span>
            <span class="status ${statusClass}">${status}</span>
            <span class="muted" title="${app.createdAt||""}">${timeago(app.createdAt)}</span>
          </div>
          <div class="row">
            <button class="btn ghost" data-action="toggle">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</button>
          </div>
        `;

        const details = document.createElement("details");
        const sum = document.createElement("summary");
        sum.innerHTML = `<span class="twist">‚ñ∂</span> –î–µ—Ç–∞–ª—ñ`;
        details.appendChild(sum);

        const fieldsHtml = `
          <div class="grid" style="gap:8px; margin-top:8px;">
            <div><b>üåç 4.</b> ${escapeHtml(app.tzCity||"")}</div>
            <div><b>‚è∞ 5.</b> ${escapeHtml(app.daily||"")}</div>
            <div><b>üìÖ 6.</b> ${escapeHtml(app.serverTime||"")}</div>
            <div><b>üè∞ 7.</b> ${escapeHtml(app.prevClans||"")}</div>
            <div><b>üö™ 8.</b> ${escapeHtml(app.leaveReason||"")}</div>
            <div><b>‚ú® 9.</b> ${nl2br(escapeHtml(app.whyUs||""))}</div>
            <div><b>üí™ 10.</b> ${nl2br(escapeHtml(app.help||""))}</div>
            <div><b>üìè 11.</b> ${escapeHtml(app.discipline||"")}</div>
            <div><b>üéôÔ∏è 12.</b> ${escapeHtml(app.micDiscord||"")}</div>
            <div><b>üì¢ 13.</b> ${escapeHtml(app.meetings||"")}</div>
            <div><b>üìñ 14.</b> ${escapeHtml(app.rules||"")}</div>
            <div><b>üéØ 15.</b> ${nl2br(escapeHtml(app.skills||""))}</div>
            <div><b>üõ°Ô∏è 16.</b> ${escapeHtml(app.followOrders||"")}</div>
            <div><b>üöó 17.</b> ${escapeHtml(app.assets||"")}</div>
            <div><b>‚ö†Ô∏è 18.</b> ${escapeHtml(app.bans||"")}</div>
            <div><b>ü§ù 19.</b> ${escapeHtml(app.teamwork||"")}</div>
            <div><b>üìù 20.</b> ${nl2br(escapeHtml(app.extra||""))}</div>
          </div>
        `;
        const inner = document.createElement("div");
        inner.style.marginTop = "10px";
        inner.innerHTML = fieldsHtml;

        if (app.modComment){
          const sep = document.createElement("div");
          sep.className = "sep";
          const cm = document.createElement("div");
          cm.innerHTML = `<span class="muted"><b>–ö–æ–º–µ–Ω—Ç–∞—Ä –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞:</b></span><br>${nl2br(escapeHtml(app.modComment))}`;
          inner.appendChild(sep);
          inner.appendChild(cm);
        }

        details.appendChild(inner);

        wrap.appendChild(head);
        wrap.appendChild(details);

        // moderation controls
        if (STATE.isModerator){
          const sep = document.createElement("div"); sep.className = "sep";
          const actions = document.createElement("div"); actions.className = "row";
          const approve = document.createElement("button"); approve.className = "btn success"; approve.textContent = "–°—Ö–≤–∞–ª–∏—Ç–∏";
          const reject = document.createElement("button"); reject.className = "btn danger"; reject.textContent = "–í—ñ–¥—Ö–∏–ª–∏—Ç–∏";
          const commentBox = document.createElement("div"); commentBox.className = "comment-box";
          const cInput = document.createElement("input"); cInput.placeholder = "–ó–∞–ª–∏—à–∏—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä‚Ä¶"; cInput.value = app.modComment || "";
          const saveC = document.createElement("button"); saveC.className = "btn primary"; saveC.textContent = "–ó–±–µ—Ä–µ–≥—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä";

          approve.onclick = () => setStatus(app.id, "approved");
          reject.onclick  = () => setStatus(app.id, "rejected");
          saveC.onclick   = () => setComment(app.id, cInput.value);

          actions.appendChild(approve);
          actions.appendChild(reject);
          commentBox.appendChild(cInput);
          commentBox.appendChild(saveC);

          wrap.appendChild(sep);
          wrap.appendChild(actions);
          wrap.appendChild(commentBox);
        }

        head.querySelector('[data-action="toggle"]').onclick = () => {
          details.open = !details.open;
        };

        listEl.appendChild(wrap);
      }
    }

    // ========= MUTATIONS =========
    function setStatus(id, status){
      const i = STATE.applications.findIndex(a => a.id === id);
      if (i === -1) return;
      STATE.applications[i].status = status;
      STATE.applications[i].updatedAt = nowISO();
      saveLocal();
      renderList($("#search").value||"");
    }
    function setComment(id, text){
      const i = STATE.applications.findIndex(a => a.id === id);
      if (i === -1) return;
      STATE.applications[i].modComment = text || "";
      STATE.applications[i].updatedAt = nowISO();
      saveLocal();
      renderList($("#search").value||"");
    }

    // ========= EVENTS =========
    $("#form").addEventListener("submit", e => {
      e.preventDefault();
      const fd = new FormData(e.target);
      const app = {
        id: uid(),
        createdAt: nowISO(),
        updatedAt: nowISO(),
        status: "pending",
        // fields:
        nick: fd.get("nick")?.toString().trim(),
        gameId: fd.get("gameId")?.toString().trim(),
        age: Number(fd.get("age")||""),
        tzCity: fd.get("tzCity")?.toString().trim(),
        daily: fd.get("daily")?.toString().trim(),
        serverTime: fd.get("serverTime")?.toString().trim(),
        prevClans: fd.get("prevClans")?.toString().trim(),
        leaveReason: fd.get("leaveReason")?.toString().trim(),
        whyUs: fd.get("whyUs")?.toString().trim(),
        help: fd.get("help")?.toString().trim(),
        discipline: fd.get("discipline")?.toString().trim(),
        micDiscord: fd.get("micDiscord")?.toString().trim(),
        meetings: fd.get("meetings")?.toString().trim(),
        rules: Number(fd.get("rules")||""),
        skills: fd.get("skills")?.toString().trim(),
        followOrders: fd.get("followOrders")?.toString().trim(),
        assets: fd.get("assets")?.toString().trim(),
        bans: fd.get("bans")?.toString().trim(),
        teamwork: fd.get("teamwork")?.toString().trim(),
        extra: fd.get("extra")?.toString().trim(),
        modComment: ""
      };

      // –ø—Ä–æ—Å—Ç—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
      if (!app.nick || !app.gameId || !app.age || !app.tzCity || !app.daily || !app.serverTime || !app.whyUs || !app.help || !app.discipline || !app.micDiscord || !app.meetings || !app.rules || !app.skills || !app.followOrders || !app.teamwork){
        alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω–∏ –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è.");
        return;
      }

      STATE.applications.push(app);
      saveLocal();
      e.target.reset();
      renderList($("#search").value||"");
      window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
    });

    $("#modLogin").addEventListener("click", () => {
      const pass = $("#modPass").value;
      if (pass !== MOD_PASSWORD){ alert("–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å."); return; }
      STATE.isModerator = true;
      modeTag.textContent = "Mode: local-only (moderator)";
      renderList($("#search").value||"");
      alert("–ì–æ—Ç–æ–≤–æ. –ú–æ–∂–µ—à –º–æ–¥–µ—Ä—É–≤–∞—Ç–∏ –∑–∞—è–≤–∫–∏.");
    });

    $("#exportBtn").addEventListener("click", () => {
      const json = JSON.stringify(STATE.applications, null, 2);
      download("applications.json", json, "application/json");
      // –ø—ñ–¥–∫–∞–∑–∫–∞: —Ç–∞–∫–æ–∂ –º–æ–∂–Ω–∞ CSV
      // download("applications.csv", toCSV(STATE.applications), "text/csv");
    });

    $("#importInput").addEventListener("change", async (e) => {
      const file = e.target.files?.[0];
      if (!file) return;
      const text = await file.text();
      try {
        const data = JSON.parse(text);
        if (!Array.isArray(data)) throw new Error("JSON –º–∞—î –±—É—Ç–∏ –º–∞—Å–∏–≤–æ–º");
        if (!confirm("–Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ —ñ –∑–∞–º—ñ–Ω–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—ñ –∑–∞—è–≤–∫–∏?")) return;
        STATE.applications = data;
        saveLocal();
        renderList($("#search").value||"");
        alert("–Ü–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ.");
      } catch (err){
        alert("–ü–æ–º–∏–ª–∫–∞ —ñ–º–ø–æ—Ä—Ç—É JSON: " + err.message);
      } finally {
        e.target.value = "";
      }
    });

    $("#reloadRemote").addEventListener("click", async () => {
      try {
        const res = await fetch(REMOTE_JSON_URL, {cache:"no-store"});
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        if (!Array.isArray(data)) throw new Error("–û—á—ñ–∫—É–≤–∞–≤ –º–∞—Å–∏–≤ –∑–∞—è–≤–æ–∫");
        if (!confirm("–ó–∞–º—ñ–Ω–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—ñ –∑–∞—è–≤–∫–∏ –¥–∞–Ω–∏–º–∏ –∑ GitHub?")) return;
        STATE.applications = data;
        saveLocal();
        renderList($("#search").value||"");
        alert("–û–Ω–æ–≤–ª–µ–Ω–æ –∑ GitHub.");
      } catch (e){
        alert("–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ data/applications.json. –ú–æ–∂–ª–∏–≤–æ, —Ñ–∞–π–ª —â–µ –Ω–µ –∑–∞–ª–∏—Ç–∏–π.");
      }
    });

    $("#search").addEventListener("input", (e) => renderList(e.target.value));
    $("#clearAll").addEventListener("click", () => {
      if (!confirm("–û—á–∏—Å—Ç–∏—Ç–∏ –í–°–Ü –ª–æ–∫–∞–ª—å–Ω—ñ –∑–∞—è–≤–∫–∏ –≤ —Ü—å–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ?")) return;
      STATE.applications = [];
      saveLocal();
      renderList($("#search").value||"");
    });

    // ========= BOOT =========
    (async function init(){
      loadLocal();
      // —è–∫—â–æ —É —Ä–µ–ø–æ –≤–∂–µ —î —Å–ø—ñ–ª—å–Ω–∏–π —Ñ–∞–π–ª ‚Äî –ø—ñ–¥—Ç—è–≥–Ω–µ–º–æ —è–∫ –±–∞–∑—É (—Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –ª–æ–∫–∞–ª—å–Ω–æ –ø—É—Å—Ç–æ)
      if (!STATE.applications.length){
        try {
          const res = await fetch(REMOTE_JSON_URL, {cache:"no-store"});
          if (res.ok){
            const data = await res.json();
            if (Array.isArray(data)){
              STATE.applications = data;
              saveLocal();
            }
          }
        } catch {}
      }
      renderList();
    })();
  </script>
</body>
</html>
